================================================================================
SpiraApp MVP: Configurable Project-Specific Assessments - RESEARCH COMPLETE
================================================================================

DELIVERABLES CREATED:
================================================================================

1. SPIRAAPP_CONFIGURABLE_ASSESSMENTS_RESEARCH.md (Main Document)
   â”œâ”€ 18 comprehensive sections
   â”œâ”€ 1,100+ lines of detailed analysis
   â”œâ”€ Complete architecture documentation
   â”œâ”€ Implementation approaches (A, B, C)
   â”œâ”€ Technical considerations & risks
   â””â”€ Recommendations & roadmap

2. SPIRAAPP_QUICK_REFERENCE.md (Fast Lookup)
   â”œâ”€ Current state summary table
   â”œâ”€ Key file locations
   â”œâ”€ Critical lessons learned
   â”œâ”€ JSON schema reference
   â”œâ”€ Debugging guide
   â”œâ”€ Scoring logic explanation
   â””â”€ Next steps checklist

3. SPIRAAPP_ARCHITECTURE_DIAGRAMS.md (Visual Reference)
   â”œâ”€ 10 detailed flow diagrams
   â”œâ”€ Current assessment flow
   â”œâ”€ Storage architecture
   â”œâ”€ Configuration flow
   â”œâ”€ Data models
   â”œâ”€ Scoring process
   â”œâ”€ Approach comparisons
   â”œâ”€ Multi-tenant organization
   â”œâ”€ State machine lifecycle
   â”œâ”€ Error handling flows
   â””â”€ Offline considerations

================================================================================
KEY FINDINGS
================================================================================

CURRENT STATE:
âœ… Custom framework upload: Partially implemented
âœ… Framework validation: Working (settings.js lines 362-419)
âœ… Per-product storage: Working via SpiraApp storage API
âœ… Dynamic form rendering: Working (widget.js lines 642-660)
âœ… Custom scoring: Mostly working (domain weights supported)
âš ï¸  Limited to 0-5 score scale (hardcoded)
âŒ Backend integration: Not implemented

ARCHITECTURE:
â€¢ SpiraApp is PURE CLIENT-SIDE (JavaScript IIFE in Spira dashboard)
â€¢ No external API calls possible (security sandboxed)
â€¢ Storage: Per-product key/value pairs via spiraAppManager API
â€¢ No external imports/dependencies allowed
â€¢ Fully offline-capable in current MVP form

ASSESSMENT FRAMEWORK STRUCTURE:
Framework
â”œâ”€ meta (name, description, version)
â””â”€ domains [0..N]
   â”œâ”€ id, name, weight, order
   â””â”€ questions [0..M]
      â”œâ”€ id, text, guidance, order
      â””â”€ options [0..L] (auto-generated if not provided)

CURRENT QUESTION SETS:
1. DevOps Maturity MVP: 20 questions, 3 domains
2. DORA Metrics: 25 questions, 5 domains
3. CALMS Framework: Available but not detailed
4. Backend also supports custom seeding via seed scripts

================================================================================
STORAGE MECHANISMS
================================================================================

SpiraApp Storage Keys (Per Product):
â”œâ”€ custom_framework: Custom assessment JSON (one per product)
â””â”€ dmm_assessments_history: Array of past assessment results

API Signature (CRITICAL):
spiraAppManager.storageGetProduct(
  appGuid,        // "4B8D9721-6A99-4786-903D-9346739A0673"
  appName,        // "DevOpsMaturityAssessment" (must include!)
  key,            // "custom_framework"
  productId,      // from spiraAppManager.projectId
  successCallback,
  errorCallback
)

GOTCHAS (From lessons-learned.md):
1. Must include pluginName parameter (omitting causes logout)
2. Container ID is LOWERCASE (case-sensitivity fix needed)
3. IIFE wrapping prevents variable collision
4. "Key not found" 500 error on first run is expected

================================================================================
IMPLEMENTATION APPROACHES
================================================================================

APPROACH A: Local Custom Framework (Current MVP)
â”œâ”€ Product admin uploads JSON file
â”œâ”€ Validated before saving to storage
â”œâ”€ Works entirely offline
â”œâ”€ Per-product configuration
â”œâ”€ Manual upload required per product
âœ… Pros: Works, offline, simple
âŒ Cons: Manual, no sharing, no versioning

APPROACH B: Backend-Driven Framework Selection
â”œâ”€ Admin selects from dropdown
â”œâ”€ Fetches framework from backend API
â”œâ”€ Centralized framework library
â”œâ”€ Easy to add new frameworks
â”œâ”€ Requires internet connection
âœ… Pros: Centralized, scalable, multi-org support
âŒ Cons: Complex, backend dependency, needs fallback

APPROACH C: Hybrid (RECOMMENDED)
â”œâ”€ Supports both local upload AND backend selection
â”œâ”€ Fallback chain: custom â†’ backend â†’ default
â”œâ”€ Works offline with cached frameworks
â”œâ”€ Admin can use either mode
â”œâ”€ Maximum flexibility
âœ… Pros: Flexible, offline-capable, no breaking changes
âŒ Cons: More complex implementation

COMPARISON:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Feature  â”‚ Approach â”‚ Approach  â”‚Approach â”‚
â”‚          â”‚    A     â”‚     B     â”‚    C    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Offline  â”‚    âœ…    â”‚     âŒ    â”‚   âœ…    â”‚
â”‚ Sharing  â”‚    âŒ    â”‚     âœ…    â”‚   âœ…    â”‚
â”‚ Centralized â”‚ âŒ    â”‚     âœ…    â”‚   âœ…    â”‚
â”‚ Complex  â”‚    âŒ    â”‚     âœ…    â”‚   âš ï¸    â”‚
â”‚ Multi-orgâ”‚    âš ï¸    â”‚     âœ…    â”‚   âœ…    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
SCORING ALGORITHM
================================================================================

Process:
1. Collect responses: question_id â†’ score (0-5)
2. Per domain: sum_score / (question_count Ã— 5) Ã— 100 = domain%
3. Overall: Î£(domain% Ã— domain_weight)
4. Map to level:
   - 0-20%:   Level 1 (Initial)
   - 21-40%:  Level 2 (Developing)
   - 41-60%:  Level 3 (Defined)
   - 61-80%:  Level 4 (Managed)
   - 81-100%: Level 5 (Optimizing)

Currently Hardcoded:
âœ… Score range: 0-5 per question
âœ… Domain weights: Customizable per framework
âŒ Threshold levels: Fixed (could be made custom)
âŒ Score range: Fixed at 0-5 (could support 0-3, 0-4, 0-10)

Extensibility Needed:
â€¢ Add scoreRange to meta: support variable scales
â€¢ Add levelThresholds to meta: support custom levels
â€¢ Add levelNames to meta: custom maturity names

================================================================================
VALIDATION SCHEMA
================================================================================

Current Validation (settings.js lines 362-419):
âœ… meta.name (required, non-empty string)
âœ… domains (required, non-empty array)
âœ… domain.id (required, string)
âœ… domain.name (required, string)
âœ… domain.weight (required, number)
âœ… domain.questions (required, non-empty array)
âœ… question.id (required, string)
âœ… question.text (required, string)
âš ï¸  Domain weights sum ~1.0 (warns if off by >0.01)

Missing Validation:
âŒ scoreRange type checking
âŒ levelThresholds array validation
âŒ Duplicate question IDs check
âŒ Score consistency in guidance text

================================================================================
PROJECT-SPECIFIC SCENARIOS
================================================================================

SCENARIO 1: Multi-Product, Different Assessments
â”œâ”€ Organization with 3 products
â”œâ”€ Each product uses different assessment
â”œâ”€ Uses: Approach A (local custom framework)
â”œâ”€ Each product admin uploads their own JSON
â””â”€ Result: Per-product isolation

SCENARIO 2: Multi-Organization, Centralized Library
â”œâ”€ Multiple organizations in system
â”œâ”€ Centralized framework definitions
â”œâ”€ Admin manages org-level templates
â”œâ”€ Products inherit or customize
â”œâ”€ Uses: Approach B (backend-driven)
â””â”€ Result: Enterprise-scale framework management

SCENARIO 3: Hybrid Multi-Tenant
â”œâ”€ Central framework library + local overrides
â”œâ”€ Organization templates + product customization
â”œâ”€ Fallback chain for flexibility
â”œâ”€ Uses: Approach C (hybrid)
â””â”€ Result: Maximum flexibility + standardization

================================================================================
FILE STRUCTURE
================================================================================

Core SpiraApp Files:
/home/jim/projects/devops-maturity-model/
â”œâ”€â”€ src/spiraapp-mvp/
â”‚   â”œâ”€â”€ manifest.yaml (33 lines) - Config
â”‚   â”œâ”€â”€ widget.js (988 lines) - Main logic
â”‚   â”œâ”€â”€ settings.js (603 lines) - Admin UI
â”‚   â”œâ”€â”€ assessment-template.json (60 lines) - Schema
â”‚   â”œâ”€â”€ widget.css (embedded in widget.js)
â”‚   â””â”€â”€ settings.css
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ spiraapp-lessons-learned.md
    â””â”€â”€ SpiraApp_Information/
        â”œâ”€â”€ SpiraApps-Overview.md
        â”œâ”€â”€ SpiraApps-Manifest.md
        â”œâ”€â”€ SpiraApps-Reference.md
        â”œâ”€â”€ SpiraApps-Manager.md
        â””â”€â”€ SpiraRestAPI-v7.0-OpenAPI.json

Backend Framework Definitions:
â”œâ”€â”€ backend/app/
â”‚   â”œâ”€â”€ models.py (Framework, FrameworkDomain, Gate, Question)
â”‚   â”œâ”€â”€ api/frameworks.py (REST endpoints)
â”‚   â”œâ”€â”€ api/assessments.py (Assessment endpoints)
â”‚   â””â”€â”€ scripts/
â”‚       â”œâ”€â”€ seed_frameworks.py (MVP: 5 domains)
â”‚       â”œâ”€â”€ seed_dora_framework.py (DORA: 25 questions)
â”‚       â””â”€â”€ seed_calms_framework.py (CALMS framework)
â”‚
â””â”€â”€ backend/app/core/
    â””â”€â”€ gates.py (GATES_DEFINITION: hardcoded questions)

================================================================================
IMPLEMENTATION ROADMAP
================================================================================

PHASE 1: Validate Current MVP (Week 1)
âœ“ Test custom framework upload
âœ“ Verify scoring calculations
âœ“ Test offline functionality
âœ“ Verify framework switching

PHASE 2: Enhance Validation (Week 2-3)
â–¡ Improve error messages
â–¡ Add dry-run preview
â–¡ Support custom score ranges (0-3, 0-4, 0-10)
â–¡ Add assessment export

PHASE 3: Backend Integration (Week 4-5)
â–¡ Add product setting: "Select Framework"
â–¡ Fetch from /api/frameworks/structure
â–¡ Implement fallback chain
â–¡ Add offline caching

PHASE 4: Advanced Features (Week 6-8)
â–¡ Organization-level templates
â–¡ Per-product customization
â–¡ Assessment history export
â–¡ Comparison dashboard
â–¡ Framework versioning

================================================================================
CRITICAL CODE REFERENCES
================================================================================

Widget Initialization:
â”œâ”€ Line 416: spiraAppManager.registerEvent_windowLoad(initDmmWidget)
â”œâ”€ Line 420: initDmmWidget() function
â”œâ”€ Line 423: loadCustomFramework() called
â””â”€ Line 429: loadCustomFramework() implementation

Custom Framework Loading:
â”œâ”€ Line 429: loadCustomFramework() - fetch from storage
â”œâ”€ Line 442: activeFramework = JSON.parse(data)
â”œâ”€ Line 456: Error handling (expected on first run)
â””â”€ Line 476: Clear logs on fresh load

Form Rendering:
â”œâ”€ Line 631: renderAssessmentForm() - main entry point
â”œâ”€ Line 642: if (activeFramework && activeFramework.domains) - custom check
â”œâ”€ Line 645: Build from custom domains
â”œâ”€ Line 662: else - build from DMM_QUESTIONS
â””â”€ Line 686: Render with Mustache template

Scoring:
â”œâ”€ Line 825: calculateScores(responses) - main scoring function
â”œâ”€ Line 836: Initialize domainTotals
â”œâ”€ Line 844: Tally scores per domain
â”œâ”€ Line 856: Calculate domain percentages
â”œâ”€ Line 860: Apply domain weights
â””â”€ Line 869: Map to maturity levels

Storage:
â”œâ”€ Line 535: storageGetProduct() to fetch history
â”œâ”€ Line 922: storageUpdateProduct() to update
â”œâ”€ Line 936: storageInsertProduct() fallback
â””â”€ Line 956: Insert new assessment

Settings (settings.js):
â”œâ”€ Line 217: storageGetProduct() to load current
â”œâ”€ Line 244: renderCurrentStatus() display
â”œâ”€ Line 319: processFile() - handle upload
â”œâ”€ Line 336: JSON.parse() - parse file
â”œâ”€ Line 339: validateFramework() - validate
â”œâ”€ Line 483: saveFramework() - persist
â””â”€ Line 501: Try update, fallback to insert

Validation (settings.js):
â”œâ”€ Line 362: validateFramework() function
â”œâ”€ Line 366: Check meta.name
â”œâ”€ Line 375: Check domains array
â”œâ”€ Line 381: Check domain properties
â”œâ”€ Line 389: Check domain.weight and sum
â”œâ”€ Line 394: Check questions in domain
â””â”€ Line 398: Check question properties

Templates:
â”œâ”€ Line 311: TPL_SUMMARY - summary view
â”œâ”€ Line 339: TPL_FORM - assessment form
â”œâ”€ Line 374: TPL_RESULTS - results view

================================================================================
RISKS & MITIGATIONS
================================================================================

Risk: Custom JSON is malformed
â”œâ”€ Impact: Assessment breaks
â””â”€ Mitigation: Strict validation, better error messages

Risk: Framework file is large
â”œâ”€ Impact: Storage quota exceeded
â””â”€ Mitigation: Compress, archive old, set limit

Risk: Backend API unavailable
â”œâ”€ Impact: Widget cannot load framework
â””â”€ Mitigation: Fallback chain, client-side caching

Risk: Weights don't sum to 1.0
â”œâ”€ Impact: Scoring incorrect
â””â”€ Mitigation: Warn user, auto-normalize option

Risk: Product admin breaks framework
â”œâ”€ Impact: All assessments fail
â””â”€ Mitigation: Version control, rollback

Risk: User confusion (which framework?)
â”œâ”€ Impact: Wrong assessment
â””â”€ Mitigation: Show prominently, add description

================================================================================
RECOMMENDED NEXT STEPS
================================================================================

SHORT TERM (This Sprint):
1. Complete Approach A implementation:
   âœ“ Framework upload already works
   â–¡ Add import/export functionality
   â–¡ Add framework preview/editing
   
2. Enhance documentation:
   â–¡ Create admin guide for creating frameworks
   â–¡ Document JSON schema clearly
   â–¡ Add example frameworks (mobile, finance, etc.)

3. Improve error handling:
   â–¡ Better error messages for invalid JSON
   â–¡ Add dry-run before saving
   â–¡ Improve logging/debugging

MEDIUM TERM (Next Quarter):
1. Implement Approach C (hybrid):
   â–¡ Keep local upload working
   â–¡ Add backend framework selection
   â–¡ Implement fallback chain
   
2. Backend-driven features:
   â–¡ Framework management UI
   â–¡ Version control for frameworks
   â–¡ Framework sharing across products

3. Enhanced reporting:
   â–¡ Export assessment results
   â–¡ Trend analysis
   â–¡ Comparison across assessments

LONG TERM (Next 6 Months):
1. Multi-tenant enhancements:
   â–¡ Organization-level templates
   â–¡ Per-product customization
   â–¡ Role-based access control

2. Advanced analytics:
   â–¡ Benchmarking
   â–¡ Recommendations
   â–¡ Industry standards comparison

3. Integration:
   â–¡ External tool integrations
   â–¡ Mobile app
   â–¡ API for third-party tools

================================================================================
DOCUMENT LOCATIONS
================================================================================

Comprehensive Research:
ğŸ“„ SPIRAAPP_CONFIGURABLE_ASSESSMENTS_RESEARCH.md
   â””â”€ 18 sections, 1,100+ lines, complete analysis

Quick Reference:
ğŸ“„ SPIRAAPP_QUICK_REFERENCE.md
   â””â”€ Tables, checklists, debugging guide

Architecture Diagrams:
ğŸ“„ SPIRAAPP_ARCHITECTURE_DIAGRAMS.md
   â””â”€ 10 detailed flow diagrams

This Summary:
ğŸ“„ RESEARCH_SUMMARY.txt (this file)
   â””â”€ Quick overview, key findings, next steps

Original Documentation:
ğŸ“ docs/spiraapp-lessons-learned.md
ğŸ“ docs/SpiraApp_Information/ (complete SpiraApp docs)

================================================================================
CONTACT & SUPPORT
================================================================================

For questions about this research:
â€¢ Review SPIRAAPP_CONFIGURABLE_ASSESSMENTS_RESEARCH.md (main document)
â€¢ Check SPIRAAPP_QUICK_REFERENCE.md for quick answers
â€¢ See SPIRAAPP_ARCHITECTURE_DIAGRAMS.md for visual explanations
â€¢ Consult docs/spiraapp-lessons-learned.md for API gotchas

For SpiraApp API documentation:
â€¢ docs/SpiraApp_Information/SpiraApps-Manager.md
â€¢ docs/SpiraApp_Information/SpiraApps-Overview.md
â€¢ docs/SpiraApp_Information/SpiraApps-Reference.md

================================================================================
RESEARCH COMPLETED: 2026-01-17
DOCUMENTS CREATED: 3 comprehensive files + this summary
TOTAL DOCUMENTATION: 2,500+ lines
================================================================================
